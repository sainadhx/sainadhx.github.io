<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using Zig in Python</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <header>
        <nav>
            <a href="/">Home</a>
            <a href="/blog/">Blog</a>
        </nav>
    </header>
    <main>
        <h1>Using Zig in Python</h1>
        <p class="post-date">January 21, 2026</p>
        <p>Lets say you have a Python application and want to speed up a piece of code, you would have various options like making Algorithmic improvoments, using better data structures, etc. However another option you would have is to write that piece of code in a low-level language (like C, Zig, Odin etc..) and use it in your application. In this post lets see how we can use Python cffi and Zig to do the same.</p>
<hr>
<h2>Prerequisites</h2>
<p>Install cffi</p>
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;"><code><span style="display:flex;"><span>pip install cffi
</span></span></code></pre><hr>
<h2>Minimal Example</h2>
<p>Lets start with a small function and get it to work.</p>
<p>First lets create a Zig file (<code>math.zig</code>) with a simple method to add 2 integers.</p>
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;"><code><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">export</span> <span style="color:#81a1c1;font-weight:bold">fn</span> add<span style="color:#eceff4">(</span>a<span style="color:#81a1c1">:</span> <span style="color:#81a1c1">i32</span><span style="color:#eceff4">,</span> b<span style="color:#81a1c1">:</span> <span style="color:#81a1c1">i32</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">i32</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> a <span style="color:#81a1c1">+</span> b<span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre><p>We need to add export so that this <code>add</code> function is available for others to use.</p>
<p>Lets compile this and create a dynamic library. (We can then load this from python)</p>
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;"><code><span style="display:flex;"><span>zig build-lib -dynamic math.zig
</span></span></code></pre><p>This should create a libmath.dylib (if you are on MacOS)</p>
<p>Now lets use this in python</p>
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;"><code><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#8fbcbb">os</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">from</span> <span style="color:#8fbcbb">cffi</span> <span style="color:#81a1c1;font-weight:bold">import</span> FFI
</span></span><span style="display:flex;"><span>ffi <span style="color:#81a1c1">=</span> FFI<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ffi<span style="color:#81a1c1">.</span>cdef<span style="color:#eceff4">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a3be8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#a3be8c">    int add(int a, int b);
</span></span></span><span style="display:flex;"><span><span style="color:#a3be8c">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>math <span style="color:#81a1c1">=</span> ffi<span style="color:#81a1c1">.</span>dlopen<span style="color:#eceff4">(</span>os<span style="color:#81a1c1">.</span>path<span style="color:#81a1c1">.</span>abspath<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;libmath.dylib&#34;</span><span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span>math<span style="color:#81a1c1">.</span>add<span style="color:#eceff4">(</span><span style="color:#b48ead">2</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">3</span><span style="color:#eceff4">))</span>
</span></span></code></pre><p>Here we did a few things</p>
<ol>
<li>Imported <code>FFI</code> from <code>cffi</code></li>
<li>Define our exported function declaration using <code>cdef</code>. As you might have guessed cdef is the c definition of the function we declared in Zig.</li>
<li>Open the dylib using <code>ffi.dlopen</code></li>
<li>Call our exported function using <code>math.add</code></li>
</ol>
<p>If you did everything correctly, you should be able to run the basic.py</p>
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;"><code><span style="display:flex;"><span>⇛ python3 basic.py
</span></span><span style="display:flex;"><span><span style="color:#b48ead">5</span>
</span></span></code></pre><hr>
<h2>Levenshtein Distance</h2>
<p>To make this more interesting, lets say you are building a Fuzzy finder or auto-suggest in Python and using Levenshtein distance as an algorithm to get closest matches for a given word.</p>
<p>The below is levenshtein distance in python. Its a simple algorithm that uses Dynamic Programming to figure out the number of edits you have to make to convert one string to the other. For example levenshtein(&quot;den&quot;, &quot;pen&quot;) = 1, since you can replace d with p.</p>
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;"><code><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> <span style="color:#88c0d0">levenshtein</span><span style="color:#eceff4">(</span>s1<span style="color:#eceff4">,</span> s2<span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>s1<span style="color:#eceff4">)</span> <span style="color:#81a1c1">==</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>s2<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>s2<span style="color:#eceff4">)</span> <span style="color:#81a1c1">==</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>s1<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    m<span style="color:#eceff4">,</span> n <span style="color:#81a1c1">=</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>s1<span style="color:#eceff4">),</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>s2<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    dp <span style="color:#81a1c1">=</span> <span style="color:#eceff4">[[</span><span style="color:#b48ead">0</span> <span style="color:#81a1c1;font-weight:bold">for</span> _ <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span>n<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)]</span> <span style="color:#81a1c1;font-weight:bold">for</span> _ <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span>m<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> i <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span>m<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>        dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span><span style="color:#b48ead">0</span><span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> i
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> j <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span>n<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>        dp<span style="color:#eceff4">[</span><span style="color:#b48ead">0</span><span style="color:#eceff4">][</span>j<span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> j
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> i <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span><span style="color:#b48ead">1</span><span style="color:#eceff4">,</span> m<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">for</span> j <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span><span style="color:#b48ead">1</span><span style="color:#eceff4">,</span> n<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>            c1<span style="color:#eceff4">,</span> c2 <span style="color:#81a1c1">=</span> s1<span style="color:#eceff4">[</span>i<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">],</span> s2<span style="color:#eceff4">[</span>j<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">if</span> c1 <span style="color:#81a1c1">==</span> c2<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>                dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span>j<span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> dp<span style="color:#eceff4">[</span>i<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">][</span>j<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">else</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>                dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span>j<span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> <span style="color:#b48ead">1</span> <span style="color:#81a1c1">+</span> <span style="color:#81a1c1">min</span><span style="color:#eceff4">(</span>dp<span style="color:#eceff4">[</span>i<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">][</span>j<span style="color:#eceff4">],</span> dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span>j<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">],</span> dp<span style="color:#eceff4">[</span>i<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">][</span>j<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> dp<span style="color:#eceff4">[</span>m<span style="color:#eceff4">][</span>n<span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span>levenshtein<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;den&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;hen&#34;</span><span style="color:#eceff4">))</span>
</span></span></code></pre><p>Running the above should print <code>1</code></p>
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;"><code><span style="display:flex;"><span>⇛ python3 lev.py
</span></span><span style="display:flex;"><span><span style="color:#b48ead">1</span>
</span></span></code></pre><p>Now lets replicate the same in Zig</p>
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;"><code><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">const</span> std <span style="color:#81a1c1">=</span> <span style="color:#81a1c1">@import</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;std&#34;</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">export</span> <span style="color:#81a1c1;font-weight:bold">fn</span> levenshtein<span style="color:#eceff4">(</span>s1<span style="color:#81a1c1">:</span> <span style="color:#eceff4">[</span><span style="color:#81a1c1">*:</span><span style="color:#b48ead">0</span><span style="color:#eceff4">]</span><span style="color:#81a1c1;font-weight:bold">const</span> <span style="color:#81a1c1">u8</span><span style="color:#eceff4">,</span> s2<span style="color:#81a1c1">:</span> <span style="color:#eceff4">[</span><span style="color:#81a1c1">*:</span><span style="color:#b48ead">0</span><span style="color:#eceff4">]</span><span style="color:#81a1c1;font-weight:bold">const</span> <span style="color:#81a1c1">u8</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">u32</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">const</span> m <span style="color:#81a1c1">=</span> std<span style="color:#eceff4">.</span>mem<span style="color:#eceff4">.</span>len<span style="color:#eceff4">(</span>s1<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">const</span> n <span style="color:#81a1c1">=</span> std<span style="color:#eceff4">.</span>mem<span style="color:#eceff4">.</span>len<span style="color:#eceff4">(</span>s2<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span>m <span style="color:#81a1c1">==</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#81a1c1">@intCast</span><span style="color:#eceff4">(</span>n<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span>n <span style="color:#81a1c1">==</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#81a1c1">@intCast</span><span style="color:#eceff4">(</span>m<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">const</span> allocator <span style="color:#81a1c1">=</span> std<span style="color:#eceff4">.</span>heap<span style="color:#eceff4">.</span>c_allocator<span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">var</span> dp <span style="color:#81a1c1">=</span> allocator<span style="color:#eceff4">.</span>alloc<span style="color:#eceff4">([]</span><span style="color:#81a1c1">u32</span><span style="color:#eceff4">,</span> m <span style="color:#81a1c1">+</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">catch</span> <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">defer</span> allocator<span style="color:#eceff4">.</span>free<span style="color:#eceff4">(</span>dp<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">(</span>dp<span style="color:#eceff4">)</span> <span style="color:#81a1c1">|*</span>row<span style="color:#81a1c1">|</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        row<span style="color:#eceff4">.</span><span style="color:#81a1c1">*</span> <span style="color:#81a1c1">=</span> allocator<span style="color:#eceff4">.</span>alloc<span style="color:#eceff4">(</span><span style="color:#81a1c1">u32</span><span style="color:#eceff4">,</span> n <span style="color:#81a1c1">+</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">catch</span> <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">defer</span> <span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">(</span>dp<span style="color:#eceff4">)</span> <span style="color:#81a1c1">|</span>row<span style="color:#81a1c1">|</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        allocator<span style="color:#eceff4">.</span>free<span style="color:#eceff4">(</span>row<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">(</span><span style="color:#b48ead">0</span><span style="color:#eceff4">..</span>m<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">|</span>i<span style="color:#81a1c1">|</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">(</span><span style="color:#b48ead">0</span><span style="color:#eceff4">..</span>n<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">|</span>j<span style="color:#81a1c1">|</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>            dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span>j<span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">(</span><span style="color:#b48ead">0</span><span style="color:#eceff4">..</span>m<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">|</span>i<span style="color:#81a1c1">|</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span><span style="color:#b48ead">0</span><span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> <span style="color:#81a1c1">@intCast</span><span style="color:#eceff4">(</span>i<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">(</span><span style="color:#b48ead">0</span><span style="color:#eceff4">..</span>n<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">|</span>j<span style="color:#81a1c1">|</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        dp<span style="color:#eceff4">[</span><span style="color:#b48ead">0</span><span style="color:#eceff4">][</span>j<span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> <span style="color:#81a1c1">@intCast</span><span style="color:#eceff4">(</span>j<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">(</span><span style="color:#b48ead">1</span><span style="color:#eceff4">..</span>m<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">|</span>i<span style="color:#81a1c1">|</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">(</span><span style="color:#b48ead">1</span><span style="color:#eceff4">..</span>n<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">|</span>j<span style="color:#81a1c1">|</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span>s1<span style="color:#eceff4">[</span>i<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">]</span> <span style="color:#81a1c1">==</span> s2<span style="color:#eceff4">[</span>j<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">])</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>                dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span>j<span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> dp<span style="color:#eceff4">[</span>i<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">][</span>j<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">];</span>
</span></span><span style="display:flex;"><span>            <span style="color:#eceff4">}</span> <span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>                dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span>j<span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> <span style="color:#b48ead">1</span> <span style="color:#81a1c1">+</span> <span style="color:#81a1c1">@min</span><span style="color:#eceff4">(</span>dp<span style="color:#eceff4">[</span>i<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">][</span>j<span style="color:#eceff4">],</span> dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span>j<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">],</span> dp<span style="color:#eceff4">[</span>i<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">][</span>j<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">]);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> dp<span style="color:#eceff4">[</span>m<span style="color:#eceff4">][</span>n<span style="color:#eceff4">];</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre><p>The logic (and most of the code) is exactly the same as Python, but a few things to note here</p>
<ol>
<li>We are accepting the input params as <code>[*:0]const u8</code>. This is the equivalent to a C string in Zig</li>
<li>We are using <code>std.heap.c_allocator</code> to allocate space for the strings</li>
</ol>
<p>Now lets compile this again like before</p>
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;"><code><span style="display:flex;"><span>zig build-lib -dynamic lev.zig
</span></span></code></pre><p>This should create a <code>liblev.dylib</code></p>
<p>Now lets update our Python file to use this levenshtein library</p>
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;"><code><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#8fbcbb">os</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">from</span> <span style="color:#8fbcbb">cffi</span> <span style="color:#81a1c1;font-weight:bold">import</span> FFI
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ffi <span style="color:#81a1c1">=</span> FFI<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>ffi<span style="color:#81a1c1">.</span>cdef<span style="color:#eceff4">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a3be8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#a3be8c">    unsigned int levenshtein(char* s1, char* s2);
</span></span></span><span style="display:flex;"><span><span style="color:#a3be8c">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lev <span style="color:#81a1c1">=</span> ffi<span style="color:#81a1c1">.</span>dlopen<span style="color:#eceff4">(</span>os<span style="color:#81a1c1">.</span>path<span style="color:#81a1c1">.</span>abspath<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;liblev.dylib&#34;</span><span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> <span style="color:#88c0d0">levenshtein</span><span style="color:#eceff4">(</span>s1<span style="color:#eceff4">,</span> s2<span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>s1<span style="color:#eceff4">)</span> <span style="color:#81a1c1">==</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>s2<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>s2<span style="color:#eceff4">)</span> <span style="color:#81a1c1">==</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>s1<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    m<span style="color:#eceff4">,</span> n <span style="color:#81a1c1">=</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>s1<span style="color:#eceff4">),</span> <span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>s2<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    dp <span style="color:#81a1c1">=</span> <span style="color:#eceff4">[[</span><span style="color:#b48ead">0</span> <span style="color:#81a1c1;font-weight:bold">for</span> _ <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span>n<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)]</span> <span style="color:#81a1c1;font-weight:bold">for</span> _ <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span>m<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> i <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span>m<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>        dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span><span style="color:#b48ead">0</span><span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> i
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> j <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span>n<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>        dp<span style="color:#eceff4">[</span><span style="color:#b48ead">0</span><span style="color:#eceff4">][</span>j<span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> j
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> i <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span><span style="color:#b48ead">1</span><span style="color:#eceff4">,</span> m<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">for</span> j <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span><span style="color:#b48ead">1</span><span style="color:#eceff4">,</span> n<span style="color:#81a1c1">+</span><span style="color:#b48ead">1</span><span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>            c1<span style="color:#eceff4">,</span> c2 <span style="color:#81a1c1">=</span> s1<span style="color:#eceff4">[</span>i<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">],</span> s2<span style="color:#eceff4">[</span>j<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">if</span> c1 <span style="color:#81a1c1">==</span> c2<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>                dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span>j<span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> dp<span style="color:#eceff4">[</span>i<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">][</span>j<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#81a1c1;font-weight:bold">else</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>                dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span>j<span style="color:#eceff4">]</span> <span style="color:#81a1c1">=</span> <span style="color:#b48ead">1</span> <span style="color:#81a1c1">+</span> <span style="color:#81a1c1">min</span><span style="color:#eceff4">(</span>dp<span style="color:#eceff4">[</span>i<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">][</span>j<span style="color:#eceff4">],</span> dp<span style="color:#eceff4">[</span>i<span style="color:#eceff4">][</span>j<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">],</span> dp<span style="color:#eceff4">[</span>i<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">][</span>j<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> dp<span style="color:#eceff4">[</span>m<span style="color:#eceff4">][</span>n<span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span>levenshtein<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;den&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;hen&#34;</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">==</span> lev<span style="color:#81a1c1">.</span>levenshtein<span style="color:#eceff4">(</span><span style="color:#a3be8c">b</span><span style="color:#a3be8c">&#34;den&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">b</span><span style="color:#a3be8c">&#34;hen&#34;</span><span style="color:#eceff4">))</span>
</span></span></code></pre><p>Most of the code is self explanatory, except the fact that when calling lev.levenshtein we are passing Python string objects as bytes so that the low-level implementations can work with them.</p>
<p>Running this should print True</p>
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;"><code><span style="display:flex;"><span><span style="color:#bf616a">⇛</span> python3 lev<span style="color:#81a1c1">.</span>py
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">True</span>
</span></span></code></pre><hr>
<h2>Comparison</h2>
<p>Now lets see if we get any performance benefit by doing this.</p>
<p>The idea is this</p>
<ol>
<li>We take any random english word</li>
<li>Get top 10 matches (from an english dictionary) for the all the prefixes of the word using the Python implementation and Zig Implementation</li>
</ol>
<p>Why prefixes? Well if you think of auto-suggest, it gets called when you are typing something. For example, you could be typing 'P' ... 'Py' ... 'Pyt' ... and you keep getting updated results</p>
<p>I also added some extra checks to see that the results from both approaches match. Full code can be found <a href="https://github.com/sainadhx/py-zig/blob/main/perf_test.py">here</a></p>
<pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;"><code><span style="display:flex;"><span>⇛ python3 perf_test.py
</span></span><span style="display:flex;"><span>Results match!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Python lev:   Min: 0.388583168387413, Max: 26.69854206033051, Total: 155.6180831976235 ms
</span></span><span style="display:flex;"><span>Zig lev:      Min: 0.6060001906007528, Max: 3.7530839908868074, Total: 25.96958540380001 ms
</span></span></code></pre>
    </main>
</body>
</html>
